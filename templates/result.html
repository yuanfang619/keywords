{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}分析结果{% endblock %}

{% block head %} 
{{ super() }}
<script language="javascript" src="http://lib.sinaapp.com/js/jquery/2.0.3/jquery-2.0.3.min.js"></script>
<script language="javascript" src="/static/echarts-all.js"></script>
{% endblock %}

{% block page_content %}
<div class="page-header">
    <h1 style="font-family:Microsoft YaHei">问卷开放题文本分析小工具（演示版）</h1>
</div>
<div class="table-responsive" style="width:45%">
    <div class="bg-primary"><h3 style="font-family:Microsoft YaHei">关键词提取结果：</h3></div>
	<table id="tab" class="table table-striped">
		<tr>
                    <td>关键词</td><td>词频</td><td>提及人数</td><td>权重</td>
                </tr>
	</table>
   
</div>
<hr/>
<div id="network" style="width:80%;height:700px"></div>
<div class="row">
    <div class="col-sm-2">
        <label class="control-label" for="g">重力</label>
        <input type="text" id="g" class="form-control" name="g" value="1.1"/>
        <span id="helpBlock" class="help-block">节点聚集程度</span>
    </div>
    <div class="col-sm-2">
        <label class="control-label" for="s">缩放尺度</label>
        <input type="text" id="s" class="form-control" name="s" value="1.1"/>
        <span id="helpBlock" class="help-block">图形缩放程度</span>
    </div>
</div>
<button type="button" id="btn" class="btn btn-primary" name="btn" value="刷新"/>刷新</button>
<br/><br/><br/>
{% endblock %}

{% block scripts %}
<script src="{{bootstrap_find_resource('js/bootstrap.js', cdn='bootstrap')}}"></script>
<script language="javascript">
<!--
/**************************************json*************************************/
var str={{ keywords|safe }};
$(document).ready(function(){
	str=eval('(' + str + ')');
	$.each(str,function(i,data){
		var text="";
		text="<tr><td width='60'>"+i+"</td><td width='60'>"+data.count+"</td><td width='60'>"+data.user_num+"</td><td width='100'>"+data.weight+"</td></tr>";
		$("#tab").append(text);
	});
	
	draw();
	
	$("#btn").click(function(){
		draw();
	});
});
/**************************************network*************************************/
function draw(){
var g=$("#g").val();
var s=$("#s").val();
var myChart = echarts.init(document.getElementById('network'));
option = {
    title : {
        text: '关键词共现关系',
        subtext: '节点大小表示关键词提及人数，线宽表示同时提及次数',
        x: 'left',
        y: 'top',
	itemGap: 10,
        textStyle: {
            fontSize: 24,
            fontWeight: 'normal'
	},
	subtextStyle: {
            fontSize: 15, 
	}
    },
    tooltip : {
        trigger: 'item',
        formatter: '{b} : {c}次'
    },
    toolbox: {
        show : true,
        feature : {
            restore : {show: true},
            magicType: {
		show: true, 
		type: ['force', 'chord'],
		option: {
		    chord: {
			nodes:[
			    {% for node, value in vertice.items()[:-1] %}
                	    {name: '{{ node }}', value: '{{ value }}'},
                	    {% endfor %}
                	    {name: '{{ vertice.keys()[-1] }}', value: '{{ vertice.values()[-1] }}'}
            	        ],
            	        links : [
              		    {% for edge, value in network.items()[:-1] %}
              		    {source : '{{ edge[:edge.find('|')] }}', target : '{{ edge[edge.find('|')+1:] }}', weight : {{ value }}, value : {{ value }}, itemStyle: {normal: {lineWidth: {{ value }}}}},
              		    {% endfor %}
              		    {source : '{{ network.keys()[-1][:network.keys()[-1].find('|')] }}', target : '{{ network.keys()[-1][network.keys()[-1].find('|')+1:] }}', weight : {{ network.values()[-1] }}, value : {{ network.values()[-1] }}, itemStyle: {normal: {lineWidth: {{ network.values()[-1] }}}}}
            	        ]
		    }
	    	}
	    },
            saveAsImage : {show: true}
        }
    },
    legend: {
        x: 'left',
        data:[]
    },
    series : [
        {
            type:'force',
            name : "共现关系",
            ribbonType: false,
            categories : [
                {
                    name: '关键词'
                }
            ],
            itemStyle: {
                normal: {
                    label: {
                        show: true,
                        textStyle: {
                            color: '#333'
                        }
                    },
                    nodeStyle : {
                        brushType : 'both',
                        borderColor : 'rgba(255,215,0,0.4)',
                        borderWidth : 1
                    },
                    linkStyle: {
                        type: 'curve'
                    }
                },
                emphasis: {
                    label: {
                        show: false
                        // textStyle: null      // 默认使用全局文本样式，详见TEXTSTYLE
                    }
                }
            },
            useWorker: false,
            minRadius : 15,
            maxRadius : 25,
            gravity: g,
            scaling: s,
            roam: 'move',
            nodes:[
                {% for node, value in vertice.items()[:-1] %}
                {category:0, name: '{{ node }}', value: '{{ value }}'},
                {% endfor %}
                {category:0, name: '{{ vertice.keys()[-1] }}', value: '{{ vertice.values()[-1] }}'}
            ],
            links : [
              {% for edge, value in network.items()[:-1] %}
              {source : '{{ edge[:edge.find('|')] }}', target : '{{ edge[edge.find('|')+1:] }}', weight : {{ value }}, value : {{ value }}, itemStyle: {normal: {lineWidth: {{ value }}}}},
              {% endfor %}
              {source : '{{ network.keys()[-1][:network.keys()[-1].find('|')] }}', target : '{{ network.keys()[-1][network.keys()[-1].find('|')+1:] }}', weight : {{ network.values()[-1] }}, value : {{ network.values()[-1] }}, itemStyle: {normal: {lineWidth: {{ network.values()[-1] }}}}}
            ]
        }
    ]
};

myChart.setOption(option);
}
-->
</script>
{% endblock %}
